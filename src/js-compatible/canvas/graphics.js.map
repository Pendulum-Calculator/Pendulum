{"version":3,"sources":["../../js/canvas/graphics.ts"],"names":["Graphics","canvas","id","domObject","rootScene","width","height","lc","offsetWidth","offsetHeight","appendChild","removeChild","Graphics3D","renderer","lights","camera","createWebGLRenderer","domElement","THREE","Scene","topLight","DirectionalLight","position","set","addLight","botLight","ambientLight","AmbientLight","createPerspectiveCamera","Locator","name","light","add","remove","WebGLRenderer","antialias","alpha","setPixelRatio","window","devicePixelRatio","setSize","aspect","PerspectiveCamera","y","lookAt","up","render","updateProjectionMatrix","OrthographicCamera","Graphics2D","app","PIXI","Application","transparent","resolution","view","stage","autoDensity","resize","A","B","$","outerWidth","outerHeight","updateData"],"mappings":"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","sourcesContent":["//Module import\r\nimport * as THREE from 'three';\r\nimport * as PIXI from 'pixi.js';\r\nimport {Locator} from './locator';\r\nimport 'jquery';\r\n/**\r\n * A wrapper around THREE and PIXI rendering engines to give them the same syntax \r\n * to handle with.\r\n */\r\nabstract class Graphics {\r\n    abstract id: string;\r\n    abstract domObject: HTMLCanvasElement;\r\n    abstract rootScene: any;\r\n    width:number;\r\n    height: number;\r\n    abstract lc: Locator;\r\n    /**\r\n     * Initializes a common interface for graphics manipulations\r\n     * @param canvas The div in which the graphics renderer sits in\r\n     */\r\n    constructor(public canvas:HTMLDivElement){\r\n        this.width = canvas.offsetWidth;\r\n        this.height = canvas.offsetHeight;\r\n    }\r\n    /**\r\n     * Updates all the datasets (graphed functions) in this canvas\r\n     */\r\n    abstract updateData():void;\r\n    /**\r\n     * Called to render the root scene\r\n     */\r\n    abstract render(): void;\r\n    abstract onResize(): void;\r\n    /**\r\n     * Attaches this.domObject to the specified panel\r\n     */\r\n    public attach(): void {\r\n        this.canvas.appendChild(this.domObject);\r\n    }\r\n    /**\r\n     * Detaches this.domObject from the specified panel\r\n     */\r\n    public detach(): void {\r\n        this.canvas.removeChild(this.domObject);\r\n    }\r\n}\r\n\r\nclass Graphics3D extends Graphics {\r\n    domObject: HTMLCanvasElement;\r\n    rootScene: THREE.Scene;\r\n    private renderer:THREE.Renderer;\r\n    lights: {name?:THREE.Light}={};\r\n    camera: THREE.Camera;\r\n    lc: Locator;\r\n    constructor(public canvas:HTMLDivElement, public id = \"g3d\"){\r\n        super(canvas);\r\n        this.renderer = this.createWebGLRenderer();\r\n        this.domObject = this.renderer.domElement;\r\n        //Attach dom object\r\n        this.domObject.id = id;\r\n        //Create scene\r\n        this.rootScene = new THREE.Scene();\r\n        //Setup lighting\r\n        let topLight = new THREE.DirectionalLight(0xffffff, 0.5);\r\n        topLight.position.set(0, 0, 5);\r\n        this.addLight(\"top\", topLight);\r\n        let botLight = new THREE.DirectionalLight(0xffffff, 0.5);\r\n        botLight.position.set(0, 0, -5);\r\n        this.addLight(\"bot\", botLight);\r\n        let ambientLight = new THREE.AmbientLight(0xffffff, 0.5);\r\n        this.addLight(\"ambient\", ambientLight);\r\n        //Setup camera\r\n        this.camera=this.createPerspectiveCamera();\r\n        //Setup locator for cooridnate transformation\r\n        this.lc=new Locator();\r\n    }\r\n    public addLight(name: string, light:THREE.Light){\r\n        this.lights[name]=light;\r\n        this.rootScene.add(light);\r\n    }\r\n    public removeLight(name: string){\r\n        this.rootScene.remove(this.lights[name]);\r\n        delete this.lights[name];\r\n    }\r\n    private createWebGLRenderer():THREE.WebGLRenderer{\r\n        let renderer = new THREE.WebGLRenderer({\r\n            antialias: true,\r\n            alpha: true\r\n        });\r\n        renderer.setPixelRatio(window.devicePixelRatio);\r\n        renderer.setSize(this.width, this.height);\r\n        return renderer;\r\n    }\r\n    private createPerspectiveCamera():THREE.PerspectiveCamera{\r\n        let aspect = this.width / this.height;\r\n        let camera = new THREE.PerspectiveCamera(75, aspect, 0.01, 500);\r\n        camera.position.y = -5;\r\n        camera.lookAt(0, 0, 0);\r\n        camera.up.set(0, 0, 1);\r\n        return camera\r\n    }\r\n    updateData(){\r\n\r\n    }\r\n    render(){\r\n        this.renderer.render(this.rootScene, this.camera);\r\n    }\r\n    onResize() {\r\n        this.width = this.canvas.offsetWidth;\r\n        this.height = this.canvas.offsetHeight;\r\n        this.renderer.setSize(this.width, this.height);\r\n        if(this.camera instanceof THREE.PerspectiveCamera){\r\n            this.camera.aspect = this.width / this.height;\r\n            this.camera.updateProjectionMatrix();\r\n        }\r\n        if (this.camera instanceof THREE.OrthographicCamera)\r\n            this.camera.updateProjectionMatrix();\r\n        this.renderer.render(this.rootScene, this.camera);\r\n    }\r\n}\r\n\r\nclass Graphics2D extends Graphics {\r\n    domObject: HTMLCanvasElement;\r\n    rootScene: PIXI.Container;\r\n    app: PIXI.Application;\r\n    private renderer:PIXI.Renderer;\r\n    lc: Locator;\r\n    constructor(public canvas:HTMLDivElement, public id = \"g2d\"){\r\n        super(canvas);\r\n        this.app = new PIXI.Application({\r\n            width: this.width,\r\n            height: this.height,\r\n            antialias: true, // default: false\r\n            transparent: true, // default: false\r\n            resolution: 1 // default: 1\r\n        });\r\n        this.domObject = this.app.view;\r\n        this.domObject.id=id;\r\n        //Setup root scene\r\n        this.rootScene = this.app.stage;\r\n        //Setup renderer\r\n        this.renderer = this.app.renderer;\r\n        this.app.renderer.autoDensity = true;\r\n        //purpose served by autoDensity which takes into acount of the window.devicePixelRatio\r\n        // this.renderer.resolution = window.devicePixelRatio; \r\n        this.renderer.resize(this.width, this.height);\r\n        this.lc = new Locator();\r\n        this.lc.A = [[30, 0, 0], [0, -30, 0], [0, 0, 0]];\r\n        this.lc.B=[this.width/2, this.height/2,0];\r\n    }\r\n    updateData(){\r\n\r\n    }\r\n    render(){\r\n        this.app.render();\r\n    }\r\n    onResize(){\r\n        this.width=this.canvas.offsetWidth;\r\n        this.height = this.canvas.offsetHeight;\r\n        this.lc.B = [this.width / 2, this.height / 2, 0]\r\n        this.renderer.resize(this.width, this.height);\r\n        $(this.canvas).outerWidth(this.width);\r\n        $(this.canvas).outerHeight(this.height);\r\n        this.updateData();\r\n        this.render();\r\n    }\r\n}\r\n"],"file":"graphics.js"}