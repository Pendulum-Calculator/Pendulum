{"version":3,"sources":["../../js/canvas/graphics.ts"],"names":["Graphics","canvas","id","domObject","rootScene","datasets","width","height","lc","clock","pause","offsetWidth","offsetHeight","THREE","Clock","dataset","undefined","Error","appendChild","start","animate","stop","removeChild","requestAnimationFrame","updateDatasets","render","Graphics2D","app","renderer","vertices","PIXI","Application","antialias","transparent","resolution","view","stage","autoDensity","resize","Locator","A","B","update","$","outerWidth","outerHeight","Graphics3D","lights","camera","createWebGLRenderer","domElement","Scene","topLight","DirectionalLight","position","set","addLight","botLight","ambientLight","AmbientLight","createPerspectiveCamera","name","light","add","remove","WebGLRenderer","alpha","setPixelRatio","window","devicePixelRatio","setSize","aspect","PerspectiveCamera","y","lookAt","up","updateProjectionMatrix","OrthographicCamera","Graph","PIXIGraph","THREEGraph"],"mappings":"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","sourcesContent":["//Module import\r\nimport * as THREE from 'three';\r\nimport * as PIXI from 'pixi.js';\r\nimport {Locator} from './locator';\r\nimport 'jquery';\r\nimport { Dataset } from './types';\r\n/**\r\n * A wrapper around THREE and PIXI rendering engines to give them the same syntax \r\n * to handle with.\r\n */\r\nabstract class Graphics {\r\n    abstract id: string;\r\n    abstract domObject: HTMLCanvasElement;\r\n    abstract rootScene: any;\r\n    protected datasets: {id?: Dataset}={};\r\n    width:number;\r\n    height: number;\r\n    abstract lc: Locator;\r\n    clock: THREE.Clock;\r\n    /**\r\n     * Pauses the asynchronous animation if set to true\r\n     */\r\n    pause: boolean = false;\r\n    /**\r\n     * Initializes a common interface for graphics manipulations\r\n     * @param canvas The div in which the graphics renderer sits in\r\n     */\r\n    constructor(public canvas:HTMLDivElement){\r\n        this.width = canvas.offsetWidth;\r\n        this.height = canvas.offsetHeight;\r\n        this.clock = new THREE.Clock(false);\r\n    }\r\n    /**\r\n     * Adds a dataset to the current list of datasets\r\n     * @param dataset the dataset to be added, it has to have an id\r\n     */\r\n    addDataset(dataset: Dataset) {\r\n        if(dataset.id != undefined){\r\n            this.datasets[dataset.id] = dataset;\r\n        }\r\n        else throw new Error(\"Failed to add dataset, the id of \"+dataset+\" is not defined\");\r\n    }\r\n    /**\r\n     * Updates all the datasets (graphed functions) in this canvas\r\n     */\r\n    abstract updateDatasets():void;\r\n    /**\r\n     * Called to render the root scene\r\n     */\r\n    abstract render(): void;\r\n    abstract onResize(): void;\r\n    /**\r\n     * Attaches this.domObject to the specified panel\r\n     */\r\n    public attach(): void {\r\n        this.pause = false;\r\n        this.canvas.appendChild(this.domObject);\r\n        this.clock.start();\r\n        this.animate();\r\n    }\r\n    /**\r\n     * Detaches this.domObject from the specified panel\r\n     */\r\n    public detach(): void {\r\n        this.clock.stop();\r\n        this.canvas.removeChild(this.domObject);\r\n        this.pause = true;\r\n    }\r\n    public animate(){\r\n        if(!this.pause)\r\n            requestAnimationFrame(this.animate);\r\n        this.updateDatasets();\r\n        this.render();\r\n    }\r\n}\r\n\r\n/**\r\n * Standard 2D graphical representation\r\n */\r\nclass Graphics2D extends Graphics {\r\n    domObject: HTMLCanvasElement;\r\n    rootScene: PIXI.Container;\r\n    app: PIXI.Application;\r\n    private renderer: PIXI.Renderer;\r\n    lc: Locator;\r\n    vertices: THREE.Vector3[]=[];\r\n    constructor(public canvas: HTMLDivElement, public id = \"g2d\") {\r\n        super(canvas);\r\n        this.app = new PIXI.Application({\r\n            width: this.width,\r\n            height: this.height,\r\n            antialias: true, // default: false\r\n            transparent: true, // default: false\r\n            resolution: 1 // default: 1\r\n        });\r\n        this.domObject = this.app.view;\r\n        this.domObject.id = id;\r\n        //Setup root scene\r\n        this.rootScene = this.app.stage;\r\n        //Setup renderer\r\n        this.renderer = this.app.renderer;\r\n        this.app.renderer.autoDensity = true;\r\n        //purpose served by autoDensity which takes into acount of the window.devicePixelRatio\r\n        // this.renderer.resolution = window.devicePixelRatio; \r\n        this.renderer.resize(this.width, this.height);\r\n        this.lc = new Locator();\r\n        this.lc.A = [[30, 0, 0], [0, -30, 0], [0, 0, 0]];\r\n        this.lc.B = [this.width / 2, this.height / 2, 0];\r\n    }\r\n    updateDatasets() {\r\n        for(let id in this.datasets){\r\n            (this.datasets[id] as Dataset).update(this.lc,this.vertices);\r\n        }\r\n        for(let id in this.datasets){\r\n\r\n        }\r\n    }\r\n    render() {\r\n        this.app.render();\r\n    }\r\n    onResize() {\r\n        this.width = this.canvas.offsetWidth;\r\n        this.height = this.canvas.offsetHeight;\r\n        this.lc.B = [this.width / 2, this.height / 2, 0]\r\n        this.renderer.resize(this.width, this.height);\r\n        $(this.canvas).outerWidth(this.width);\r\n        $(this.canvas).outerHeight(this.height);\r\n        this.updateDatasets();\r\n        this.render();\r\n    }\r\n}\r\n\r\n/**\r\n * Standard 3D graphical representation\r\n */\r\nclass Graphics3D extends Graphics {\r\n    domObject: HTMLCanvasElement;\r\n    rootScene: THREE.Scene;\r\n    private renderer:THREE.Renderer;\r\n    lights: {name?:THREE.Light}={};\r\n    camera: THREE.Camera;\r\n    lc: Locator;\r\n    constructor(public canvas:HTMLDivElement, public id = \"g3d\"){\r\n        super(canvas);\r\n        this.renderer = this.createWebGLRenderer();\r\n        this.domObject = this.renderer.domElement;\r\n        //Attach dom object\r\n        this.domObject.id = id;\r\n        //Create scene\r\n        this.rootScene = new THREE.Scene();\r\n        //Setup lighting\r\n        let topLight = new THREE.DirectionalLight(0xffffff, 0.5);\r\n        topLight.position.set(0, 0, 5);\r\n        this.addLight(\"top\", topLight);\r\n        let botLight = new THREE.DirectionalLight(0xffffff, 0.5);\r\n        botLight.position.set(0, 0, -5);\r\n        this.addLight(\"bot\", botLight);\r\n        let ambientLight = new THREE.AmbientLight(0xffffff, 0.5);\r\n        this.addLight(\"ambient\", ambientLight);\r\n        //Setup camera\r\n        this.camera=this.createPerspectiveCamera();\r\n        //Setup locator for cooridnate transformation\r\n        this.lc=new Locator();\r\n    }\r\n    public addLight(name: string, light:THREE.Light){\r\n        this.lights[name]=light;\r\n        this.rootScene.add(light);\r\n    }\r\n    public removeLight(name: string){\r\n        this.rootScene.remove(this.lights[name]);\r\n        delete this.lights[name];\r\n    }\r\n    private createWebGLRenderer():THREE.WebGLRenderer{\r\n        let renderer = new THREE.WebGLRenderer({\r\n            antialias: true,\r\n            alpha: true\r\n        });\r\n        renderer.setPixelRatio(window.devicePixelRatio);\r\n        renderer.setSize(this.width, this.height);\r\n        return renderer;\r\n    }\r\n    private createPerspectiveCamera():THREE.PerspectiveCamera{\r\n        let aspect = this.width / this.height;\r\n        let camera = new THREE.PerspectiveCamera(75, aspect, 0.01, 500);\r\n        camera.position.y = -5;\r\n        camera.lookAt(0, 0, 0);\r\n        camera.up.set(0, 0, 1);\r\n        return camera;\r\n    }\r\n    updateDatasets(){\r\n\r\n    }\r\n    render(){\r\n        this.renderer.render(this.rootScene, this.camera);\r\n    }\r\n    onResize() {\r\n        this.width = this.canvas.offsetWidth;\r\n        this.height = this.canvas.offsetHeight;\r\n        this.renderer.setSize(this.width, this.height);\r\n        if(this.camera instanceof THREE.PerspectiveCamera){\r\n            this.camera.aspect = this.width / this.height;\r\n            this.camera.updateProjectionMatrix();\r\n        }\r\n        if (this.camera instanceof THREE.OrthographicCamera)\r\n            this.camera.updateProjectionMatrix();\r\n        this.renderer.render(this.rootScene, this.camera);\r\n    }\r\n}\r\n\r\n/**\r\n * Each Graph provides an interface for specific\r\n * datasets to interact with the graphics library\r\n */\r\nclass Graph{\r\n    dataset: Dataset;\r\n    constructor(dataset: Dataset){\r\n        this.dataset=dataset;\r\n    }\r\n}\r\n\r\nclass PIXIGraph{\r\n\r\n}\r\n\r\nclass THREEGraph{\r\n\r\n}\r\n\r\nexport {\r\n    Graphics,\r\n    Graphics2D,\r\n    Graphics3D,\r\n    Graph\r\n}"],"file":"graphics.js"}