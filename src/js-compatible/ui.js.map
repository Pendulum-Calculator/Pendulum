{"version":3,"sources":["../js/ui.js"],"names":["MathQuill","require","MQ","getInterface","objectBar","$","names","nameControls","defControls","indexes","getIndex","position","length","i","push","removeIndex","NameControl","varName","nameContainer","document","body","nameField","type","definition","defControl","defField","defContainer","innerHeight","outerHeight","offsetHeight","ec","DefControl","name","nameControl","nc","loadTags","each","container","parentElement","getAttribute","initiateNameControl","loadShelves","initiateDefControl","loadReference","loadDefControl","loadNameControl","updateSize","addNameField","undefined","autoIndex","html","parseHTML","append","children","addExpField","focusNext","mathquill","blur","indexOf","focus","focusLast","removeNameField","parentNode","removeChild","removeDefField","appendDefinition","removeDefinition","index","splice","Number","isInteger","insertNameField","previous","previousContainer","insertBefore","nextSibling","insertExpField","insertDefinition","field","lastElementChild","innerText","MathField","autoSubscriptNumerals","handlers","edit","enter","deleteOutOf","direction","L","upOutOf","downOutOf","module","exports"],"mappings":"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","sourcesContent":["/* jshint esversion: 6 */\r\nvar MathQuill = require(\"../../node_modules/mathquill/build/mathquill\");\r\nvar MQ = MathQuill.getInterface(2);\r\n\r\nvar objectBar = $('#object-bar')[0];\r\n\r\n// var types = {\r\n//     \":\": \"Variable\",\r\n//     \"\": \"Function\",\r\n//     \"{\": \"Object\"\r\n// };\r\n\r\nvar names = [];\r\nvar nameControls = {};\r\nvar defControls = {};\r\n\r\n/**\r\n * Used to record whether certain number slots are filled\r\n */\r\nvar indexes = [];\r\n\r\nfunction getIndex(position = 0) {\r\n    if (position >= indexes.length) {\r\n        indexes[position] = true;\r\n        return position;\r\n    }\r\n    for (var i = position; i < indexes.length; i++) {\r\n        if (!indexes[i]) {\r\n            indexes[i] = true;\r\n            return i;\r\n        }\r\n    }\r\n    indexes.push(true);\r\n    return i;\r\n}\r\n\r\nfunction removeIndex(position = 0) {\r\n    indexes[position] = false;\r\n}\r\n\r\nclass NameControl {\r\n    constructor() {\r\n        this.varName = \"\";\r\n        this.nameContainer = document.body;\r\n        this.nameField = document.body;\r\n        this.type = ':';\r\n    }\r\n    /**\r\n     * Used to synchronize height between definition container and namefield container\r\n     */\r\n    updateSize() {\r\n        var definition = this.defControl.defField;\r\n        var defContainer = this.defControl.defContainer;\r\n        $(this.nameContainer).innerHeight($(this.nameField).outerHeight());\r\n        if (definition.offsetHeight > this.nameField.offsetHeight)\r\n            $(this.nameContainer).outerHeight($(defContainer).outerHeight(true),true);\r\n        else $(defContainer).outerHeight($(this.nameField).outerHeight(true));\r\n    }\r\n\r\n    loadDefControl(ec) {\r\n        this.defControl = ec;\r\n    }\r\n}\r\nclass DefControl {\r\n    constructor() {\r\n        this.varName = \"\";\r\n        this.defContainer = document.body;\r\n        this.defField = document.body;\r\n        this.type = ':';\r\n    }\r\n    /**\r\n     * Used to synchronize height between definition container and namefield container\r\n     */\r\n    updateSize() {\r\n        var name = this.nameControl.nameField;\r\n        var nameContainer = this.nameControl.nameContainer;\r\n        $(this.defContainer).innerHeight($(this.defField).outerHeight());\r\n        if (this.defField.offsetHeight > name.offsetHeight)\r\n            $(nameContainer).outerHeight($(this.defContainer).outerHeight(true),true);\r\n        else $(this.defContainer).outerHeight($(name).outerHeight(true));\r\n    }\r\n\r\n    loadNameControl(nc = new NameControl()) {\r\n        this.type = nc.type;\r\n        this.nameControl = nc;\r\n    }\r\n}\r\n\r\nfunction loadTags() {\r\n    $('.name').each(function () {\r\n        var container = this.parentElement;\r\n        var name = container.getAttribute('varname');\r\n        var nc = initiateNameControl(name, container, this);\r\n        names.push(name);\r\n        nameControls[name] = nc;\r\n    });\r\n}\r\n\r\nfunction loadShelves() {\r\n    $('.expression').each(function () {\r\n        var container = this.parentElement;\r\n        var name = container.getAttribute('varname');\r\n        var ec = initiateDefControl(name, container, this);\r\n        defControls[name] = ec;\r\n    });\r\n}\r\n\r\nfunction loadReference() {\r\n    for (let varName in nameControls) {\r\n        var nc = nameControls[varName];\r\n        var ec = defControls[varName];\r\n        nc.loadDefControl(ec);\r\n        ec.loadNameControl(nc);\r\n        nc.updateSize();\r\n        ec.updateSize();\r\n    }\r\n}\r\n\r\nfunction addNameField(name = undefined, autoIndex = 0) {\r\n    if (name == undefined) name = 1 + autoIndex;\r\n    var html = $.parseHTML(`<div class=\"name-container\" varname=\"${name}\"><div class=\"name\">${name}</div><div class=\"type\">:</div></div>`);\r\n    $('#object-bar').append(html);\r\n    var nc = initiateNameControl(name, html[0], html[0].children[0]);\r\n    nameControls[nc.varName] = nc;\r\n}\r\n\r\nfunction addExpField(name = undefined, autoIndex = 0) {\r\n    if (name == undefined) name = 1 + autoIndex;\r\n    var html = $.parseHTML(`<div class=\\\"expression-container\\\" varname=\\\"${name} \\\"> <span class = \\\"expression\\\"></span> </div>`);\r\n    $('#mathpanel').append(html);\r\n    var ec = initiateDefControl(name, html[0], html[0].children[0]);\r\n    defControls[name] = ec;\r\n}\r\n\r\nfunction focusNext(name) {\r\n    defControls[name].mathquill.blur();\r\n    defControls[names[(names.indexOf(name) + 1) % names.length]].mathquill.focus();\r\n}\r\n\r\nfunction focusLast(name) {\r\n    defControls[name].mathquill.blur();\r\n    defControls[names[(names.indexOf(name) + names.length - 1) % names.length]].mathquill.focus();\r\n}\r\n\r\nfunction removeNameField(name = \"\") {\r\n    var nc = nameControls[name];\r\n    var html = nc.nameContainer;\r\n    html.parentNode.removeChild(html);\r\n}\r\n\r\nfunction removeDefField(name = \"\") {\r\n    var ec = defControls[name];\r\n    var html = ec.defContainer;\r\n    html.parentNode.removeChild(html);\r\n}\r\n\r\nfunction appendDefinition(name = undefined) {\r\n    addNameField(name);\r\n    addExpField(name);\r\n    var autoIndex = getIndex(names.length);\r\n    nameControls[name].loadDefControl(defControls[name], autoIndex);\r\n    defControls[name].loadNameControl(nameControls[name], autoIndex);\r\n}\r\n\r\nfunction removeDefinition(name = \"\") {\r\n    var index = -1;\r\n    if ((index = names.indexOf(name)) != -1) {\r\n        removeNameField(name);\r\n        delete nameControls[name];\r\n        removeDefField(name);\r\n        delete defControls[name];\r\n        names.splice(index, 1);\r\n        // core.removeDefinition(name);\r\n        if (Number.isInteger(+name)) removeIndex(+name - 1);\r\n    }\r\n    return index;\r\n}\r\n\r\nfunction insertNameField(previous = \"\", name = undefined, autoIndex = 0) {\r\n    if (name == undefined) name = 1 + autoIndex;\r\n    var html = $.parseHTML(`<div class=\"name-container\" varname=\"${name}\"><div class=\"name\">${name}</div><div class=\"type\">:</div></div>`);\r\n    var previousContainer = nameControls[previous].nameContainer;\r\n    previousContainer.parentNode.insertBefore(html[0], previousContainer.nextSibling);\r\n    var nc = initiateNameControl(name, html[0], html[0].children[0]);\r\n    nameControls[nc.varName] = nc;\r\n}\r\n\r\nfunction insertExpField(previous = \"\", name = undefined, autoIndex = 0) {\r\n    if (name == undefined) name = 1 + autoIndex;\r\n    var html = $.parseHTML(`<div class=\\\"expression-container\\\" varname=\\\"${name} \\\"> <span class = \\\"expression\\\"></span> </div>`);\r\n    var previousContainer = defControls[previous].defContainer;\r\n    previousContainer.parentNode.insertBefore(html[0], previousContainer.nextSibling);\r\n    var ec = initiateDefControl(name, html[0], html[0].children[0]);\r\n    defControls[ec.varName] = ec;\r\n    return name;\r\n}\r\n\r\nfunction insertDefinition(previous = \"\", name = undefined) {\r\n    var index;\r\n    if ((index = names.indexOf(previous)) != -1) {\r\n        var autoIndex = getIndex(index + 1);\r\n        name = insertNameField(previous, name, autoIndex);\r\n        name = insertExpField(previous, name, autoIndex);\r\n        names.splice(names.indexOf(previous) + 1, 0, name);\r\n        nameControls[name].loadDefControl(defControls[name]);\r\n        defControls[name].loadNameControl(nameControls[name]);\r\n    }\r\n\r\n}\r\n\r\nfunction initiateNameControl(name, container, field) {\r\n    var nc = new NameControl();\r\n    nc.nameContainer = container;\r\n    nc.nameField = field;\r\n    nc.varName = name;\r\n    // nc.parser = new NameParser();\r\n    nc.type = nc.nameContainer.lastElementChild.innerText;\r\n    nc.mathquill = MQ.MathField(nc.nameField, {\r\n        autoSubscriptNumerals: true,\r\n        handlers: {\r\n            edit: () => {\r\n                nc.updateSize();\r\n                // core.resizeGraphics();\r\n                //@TODO: replace name with identifier\r\n                // let identifier = getIdentifier(nc.parser.tokenize(nc.mathquill.latex()));\r\n                // console.log(\"updating identifier \" + nc.mathquill.latex() + \": \" + tokensToString(nc.parser.tokenize(nc.mathquill.latex())));\r\n            }\r\n        }\r\n    });\r\n    // let identifier = getIdentifier(nc.parser.tokenize(nc.mathquill.latex()));\r\n    // console.log(\"updating identifier \" + nc.mathquill.latex() + \": \" + tokensToString(nc.parser.tokenize(nc.mathquill.latex())));\r\n    // core.createDefinition(name);\r\n    return nc;\r\n}\r\n\r\nfunction initiateDefControl(name, container, field) {\r\n    var ec = new DefControl();\r\n    ec.defContainer = container;\r\n    ec.defField = field;\r\n    ec.varName = name;\r\n    // ec.parser = new Parser();\r\n    ec.mathquill = MQ.MathField(ec.defField, {\r\n        autoSubscriptNumerals: true,\r\n        handlers: {\r\n            edit: () => {\r\n                ec.updateSize();\r\n                // core.resizeGraphics();\r\n                // let rpns = ec.parser.getRPN(ec.mathquill.latex());\r\n                // console.log(rpnsToString(rpns));\r\n                // core.updateDefinition(name, rpns);\r\n            },\r\n            enter: () => {\r\n                insertDefinition(ec.varName);\r\n                focusNext(ec.varName);\r\n            },\r\n            deleteOutOf: (direction) => {\r\n                if (direction == MQ.L) {\r\n                    focusLast(name);\r\n                    removeDefinition(name);\r\n                }\r\n            },\r\n            upOutOf: () => focusLast(name),\r\n            downOutOf: () => focusNext(name)\r\n        }\r\n    });\r\n    // let rpns = ec.parser.getRPN(ec.mathquill.latex());\r\n    // core.updateDefinition(name, rpns);\r\n    return ec;\r\n}\r\n\r\nmodule.exports =  {\r\n    nameControls,\r\n    defControls,\r\n    loadTags,\r\n    loadShelves,\r\n    loadReference\r\n};"],"file":"ui.js"}