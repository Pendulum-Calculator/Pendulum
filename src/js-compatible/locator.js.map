{"version":3,"sources":["../js/locator.ts"],"names":["Locator","lc","scalex","scaley","scalez","deltax","deltay","deltaz","A","B","_standardMatrix","_graphicalMatrix","_subtractionMatrix","virCoord","checkCoord","coord","utility","dot","virtualToStandard","X","Y","Z","width","getElement","subtract","virtualToGraphical","slice","height","length","Ainverse","inv","error","Error","graCoord","pinX","factorx","pinY","factory","pinZ","factorz","pinxyz","xyz"],"mappings":"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","sourcesContent":["import * as utility from './utility';\r\n//The class that converts virtual coordinate system to its graphics presentation\r\nclass Locator {\r\n    lc = this;\r\n    //Graphics x : standard x (intrinsic)\r\n    scalex = 1;\r\n    //Graphics y : standard y (intrinsic)\r\n    scaley = 1;\r\n    scalez = 1;\r\n    //Moves virtual coordinate deltax virtual units in the x direction\r\n    deltax = 0;\r\n    //Moves virtual coordinate deltay virtual units in the y direction\r\n    deltay = 0;\r\n    deltaz = 0;\r\n    //Transformation matrix used as: C = Ap+B\r\n    A = [[1.5,0,0],\r\n         [0,1.5,0],\r\n         [0,0,1.5]];\r\n    B = [0,0,0];\r\n    constructor(){\r\n    }\r\n    private _standardMatrix=[0,0,0];\r\n    /**\r\n     * Returns a matrix representing the standard coordinate of coord\r\n     * @param virCoord: a representation of a point in the virtual coordinate\r\n     */\r\n    private virtualToStandard(virCoord: number[]):number[]{\r\n        this.checkCoord(virCoord);\r\n        this._standardMatrix[0] = (virCoord[0]+this.deltax)*this.scalex;\r\n        this._standardMatrix[1] = (virCoord[1]+this.deltay)*this.scaley; \r\n        this._standardMatrix[2] = (virCoord[2]+this.deltaz)*this.scalez;\r\n        return this._standardMatrix\r\n    }\r\n    //To graphics X\r\n    public X(...coord: number[]):number{\r\n        return utility.dot(this.A[0], this.virtualToStandard(coord))+this.B[0];\r\n    }\r\n    //To graphics Y\r\n    public Y(...coord: number[]): number {\r\n        return utility.dot(this.A[1], this.virtualToStandard(coord)) + this.B[1];\r\n    }\r\n    public Z(...coord: number[]): number {\r\n        return utility.dot(this.A[2], this.virtualToStandard(coord)) + this.B[2];\r\n    }\r\n    private _graphicalMatrix = [0,0,0];\r\n    private virtualToGraphical(virCoord: number[]):number[]{\r\n            this._graphicalMatrix[0] = this.X(...virCoord);\r\n            this._graphicalMatrix[1] = this.Y(...virCoord);\r\n            this._graphicalMatrix[2] = this.Z(...virCoord);\r\n        return this._graphicalMatrix;\r\n    }\r\n    /**\r\n     * The Width, expressed either in a vector or a single number computed from width\r\n     * @param width the width in virtual coordinates for conversion\r\n     * @param getElement the method returns a single component if the value is set to true\r\n     * or else it returns an array that corresponds to the spatial distance in graphics coordinate\r\n     */\r\n    public Width(width: number, getElement:true): number | number[] {\r\n        if(getElement){\r\n            return this.X(width,0,0)-this.X(0,0,0);\r\n        }else{\r\n            return (utility.subtract(this.virtualToGraphical([width, 0, 0]).slice(), this.virtualToGraphical([width, 0, 0])) as number[]);\r\n        }\r\n    }\r\n    /**\r\n     * The Height, expressed either in a vector or a single number computed from height\r\n     * @param height the height in virtual coordinates for conversion\r\n     * @param getElement the method returns a single component if the value is set to true\r\n     * or else it returns an array that corresponds to the spatial distance in graphics coordinate\r\n     */\r\n    public Height(height: number, getElement: true): number | number[] {\r\n        if (getElement) {\r\n            return this.Y(0, height, 0) - this.Y(0, 0, 0);\r\n        } else {\r\n            return (utility.subtract(this.virtualToGraphical([0, height, 0]).slice(), this.virtualToGraphical([0, height, 0])) as number[]);\r\n        }\r\n    }\r\n    /**\r\n     * The Length, expressed either in a vector or a single number computed from length\r\n     * @param height the length in virtual coordinates for conversion\r\n     * @param getElement the method returns a single component if the value is set to true\r\n     * or else it returns an array that corresponds to the spatial distance in graphics coordinate\r\n     */\r\n    public Length(length: number, getElement: true): number | number[] {\r\n        if (getElement) {\r\n            return this.Z(0, 0, length) - this.Z(0, 0, 0);\r\n        } else {\r\n            return (utility.subtract(this.virtualToGraphical([0, 0, length]).slice(), this.virtualToGraphical([0, 0, length])) as number[]);\r\n        }\r\n    }\r\n    private _subtractionMatrix = [0, 0, 0];\r\n    /**\r\n     * Returns a vector representing the virtual coordinate of graph coord.\r\n     * The Locator class only exposes this method because the reverse transform \r\n     * involves matrix transformation and cloning arrays. It's the fastest to not \r\n     * repeat the process for each component.\r\n     * @param graCoord: a representation of a point in the virtual coordinate\r\n     */\r\n    public xyz(...graCoord: number[]): number[] {\r\n        let Ainverse;\r\n        try{\r\n            Ainverse = utility.inv(this.A);\r\n        }catch(error){\r\n            throw new Error(\"Cannot compute the virtual coordinate, the determinant of the multiplication matrix A is 0\");\r\n        }\r\n        this.checkCoord(graCoord);\r\n        this._subtractionMatrix = (utility.subtract(graCoord, this.B) as number[]);\r\n        this._standardMatrix[0] = utility.dot(Ainverse[0], this._subtractionMatrix);\r\n        this._standardMatrix[1] = utility.dot(Ainverse[1], this._subtractionMatrix);\r\n        this._standardMatrix[2] = utility.dot(Ainverse[2], this._subtractionMatrix);\r\n        /* _subtractionMatrix is reused here as a holder for the _virtualMatrix for the sake of \r\n         * optimization.\r\n         */\r\n        this._subtractionMatrix[0] = this._standardMatrix[0] / this.scalex - this.deltax;\r\n        this._subtractionMatrix[1] = this._standardMatrix[1] / this.scaley - this.deltay;\r\n        this._subtractionMatrix[2] = this._standardMatrix[2] / this.scalez - this.deltaz;\r\n        return this._subtractionMatrix;\r\n    }\r\n    // Unimplemented until they are needed\r\n    // public float width(int Width) {\r\n    //     return x(Width, 0) - x(0, 0);\r\n    // }\r\n    // public float height(int Height) {\r\n    //     return y(0, Height) - y(0, 0);\r\n    // }\r\n    // public float length(int Length) {\r\n    //     return z(0,0,Length) - this.Z(0,0,0);\r\n    // }\r\n\r\n    /**\r\n     * Pinned zooming\r\n     * @param pinX In graphical units\r\n     * @param factorx Scale scalex by this amount\r\n     * @param pinY In graphical units\r\n     * @param factory Scale scaley by this amount\r\n     * @param pinZ In graphical units\r\n     * @param factorz Scale scalez by this amount\r\n     */\r\n    public zoom(pinX: number, factorx: number, pinY: number, factory: number, pinZ = 0, factorz = 1):void{\r\n        let pinxyz = this.xyz(pinX, pinY, pinZ);\r\n        this.scalex *= factorx;\r\n        this.scaley *= factory;\r\n        this.scalez *= factorz;\r\n        this.deltax = (pinxyz[0] + this.deltax) / factorx - pinxyz[0];\r\n        this.deltay = (pinxyz[1] + this.deltay) / factory - pinxyz[1];\r\n        this.deltaz = (pinxyz[2] + this.deltaz) / factory - pinxyz[2];\r\n    }\r\n    /**\r\n     * Validate that the coordinate has the coorect dimension\r\n     * @param coord the coordinate\r\n     */\r\n    private checkCoord(coord: number[]): number[] {\r\n        if (coord.length >= 3) return coord;\r\n        if (coord.length == 0) coord[0] = 0;\r\n        if (coord.length <= 1) coord[1] = 0;\r\n        if (coord.length <= 2) coord[2] = 0;\r\n        return coord;\r\n    }\r\n    /**\r\n     * Resets all the virtual transformers in the instance,\r\n     * excludes the graphcis transformers A and B\r\n     */\r\n    public reset():void{\r\n        this.deltax=0;\r\n        this.deltay=0;\r\n        this.deltaz=0\r\n        this.scalex=0;\r\n        this.scaley=0;\r\n        this.scalez=0;\r\n    }\r\n    /**\r\n     * Resets all the graphics matrices for affine transformaiton to the given values\r\n     * @param A Transform coefficient A, default is [[1.5,0,0],[0,1.5,0],[0,0,1.5]]\r\n     * @param B Transform offset B, default is [0,0,0]\r\n     */\r\n    public resetATransformation(A = [[1.5, 0, 0], [0, 1.5, 0], [0, 0, 1.5]], B = [0, 0, 0]):void{\r\n        this.A = A;\r\n        this.B = B;\r\n    }\r\n}\r\nexport {\r\n    Locator\r\n}"],"file":"locator.js"}